define(["jquery","util","template"],function(e,o,t){e("body").css("visibility","visible"),e(function(){function o(o){o.css({top:(e(window).height()-o.outerHeight())/2+e(document).scrollTop()})}function t(t){var a=e(window).height()>e("html").outerHeight()?e(window).height():e("html").outerHeight();e(".order-status-alert-bg").height(a),o(e(".order-status-detail")),e("#cloud-app").parent(".section").css("position","static"),e(t).show()}var a=(location.search,e("#productName").val()),r=e("#specificationsName").val(),i=e("#specificationsLease").val(),n=e("#specificationsLease").val(),s=e("#originalPrice").val(),c=e("#productId").val(),d=e("#pkSpecifications").val(),l=e("#count").val(),m=e(".order-confirm-table tr");0==s&&e("#orderConfirmSub").html("确认订单"),""!=l&&(m.eq(0).find("th").last().before("<th>数量</th>"),m.eq(1).find("td").last().before("<td>"+l+"</td>")),i<12?e("#productLeaseHtml").html(i+"个月"):i>=12?e("#productLeaseHtml").html(i/12+"年"):(m.eq(0).find("th").eq(2).hide(),m.eq(1).find("td").eq(2).hide(),n=""),1==e("#recommendCodeVal").val()&&e("#recommendCodeBox").show(),1==e("#permissionToUseVal").val()&&e("#permissionToUseBox").show(),e(".order_confirm_box_detail .order-confirm-step li").addClass("cur");var u=0;e("#agreementBtn").click(function(){0==u?(e(".gopay-mask-btn").show(),e(".order-confirm-go-pay-btn").addClass("hui"),e("#agreementBtn").attr("checked",""),u=1):(e(".gopay-mask-btn").hide(),e(".order-confirm-go-pay-btn").removeClass("hui"),e("#agreementBtn").attr("checked","checked"),u=0)});e("#permissionToUse").click(function(){0==u?(e(".gopay-mask-btn").show(),e(".order-confirm-go-pay-btn").addClass("hui"),e("#permissionToUse").attr("checked",""),u=1):(e(".gopay-mask-btn").hide(),e(".order-confirm-go-pay-btn").removeClass("hui"),e("#permissionToUse").attr("checked","checked"),u=0)});var p="",h={},f=function(){var o=r,i=n,m=s;e(".go-pay-box").append('<div class="subBtnMaskLoading"><div class="loading-w"><span></span></div></div>'),e.ajax({type:"get",dataType:"json",url:"/market/user",async:!1,success:function(e){p=e.user.userMobile},error:function(e,o,t){}});var u={operatorMobile:p,busiAmount:m,specificationsName:o,originalPrice:m,productId:c,productName:a,pkSpecifications:d,specificationsLease:i,count:l,orderNotes:e("#orderNotes").val(),recommendCode:e("#recommendCode").val()};e.ajax({type:"POST",contentType:"application/json",url:"/market/yonyoucloud/booking",data:JSON.stringify(u),dataType:"json",async:!1,success:function(o){var o=o;if(1==o.status)if(h.orderNum=o.data.agreementNum,h.orderbackurl=o.payUrl,t(".order-status-alert-box"),e(".order-confirm-step li").eq(1).addClass("cur"),e("#payLinkBtn").attr("href",o.payUrl),0!=o.data.busiAmount){var a={};a.agreementNum=h.orderNum;var r=getPayUrl(a,o.payUrl);""!=r?window.location.href=r:e(".subBtnMaskLoading").hide()}else window.location.href="/market/ordercomplete?agreementNum="+h.orderNum;else alert(o.msg)}})};e("#orderConfirmSub").on("click",function(){f()})})});
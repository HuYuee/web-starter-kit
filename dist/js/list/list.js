define(["jquery","util","template"],function(t,e,a){t("body").css("visibility","visible");var s,i=1,r={init:function(){var a,s,i,r,o,l,d=this;if(d.getProductCategory(),void 0!==e.getRequset().keyword){var n=e.parseURIComponent(e.getRequset().keyword);t(".J_SearchText").val(n)}if(l=e.getPriceDos(),s=l.price,i=l.deliver,r=l.os,o=l.customerGroup,window.location.hash.length>0){var c,a,g,u,p=e.getHashValue();a=p.category,"undefined"==a&&(a=""),d.showNavData(p.market,p.category),d.getListProduct(e.getRequset().keyword,p.market,a,void 0,void 0,s,i,r,o),g=e.getMarketName(),u=e.getCategoryName(),c=""!=u&&null!=u?g+"$$"+u:g,d.getAdvertSing(c)}else d.getListProduct(e.getRequset().keyword,void 0,a,void 0,void 0,s,i,r,o);d.bindEvent()},bindEvent:function(){var a,r=this,o=!0;t(".navp1_ul").delegate("li","click",function(){var e,a,s,i;a=t.trim(t(this).text()),i=t(this).parent().parent().parent().find(".dropdown_main").find("span").text(),e=t.trim(i),s="其他服务"!=e?e+"$$"+a:a,r.getAdvertSing(s)}),t(window).on("hashchange",function(){var t;a=e.getHashValue(),t=a.category,"undefined"==t&&(t=""),e.removeActive(),r.showNavData(a.market,a.category),r.getListProduct(e.getRequset().keyword,a.market,t,void 0,void 0,void 0,void 0,void 0,void 0,void 0),e.removeLabel()}),t("#pagecount").delegate(".ant-pagination-item","click",function(){var a,s,o,l,d,n,c,g,u,p;a=e.getFirstCategory(),o=e.getLabel(),s=e.getCategory(),p=e.getSort(),g=e.getPriceDos(),l=g.price,d=g.deliver,n=g.os,c=g.customerGroup;var u=t(this).attr("rel");i=parseInt(u),u&&r.getListProduct(e.getRequset().keyword,a,s,o,i-1,l,d,n,c,p)}),t("#pagecount").delegate(".ant-pagination-prev","click",function(){var a,s,o,l,d,n,c,g,u,p;a=e.getFirstCategory(),o=e.getLabel(),s=e.getCategory(),p=e.getSort(),g=e.getPriceDos(),l=g.price,d=g.deliver,n=g.os,c=g.customerGroup,u=t(this).attr("rel"),i=parseInt(u),t(".ant-pagination-prev").find("a").hasClass("discursor")||r.getListProduct(e.getRequset().keyword,a,s,o,i-1,l,d,n,c,p)}),t("#pagecount").delegate(".ant-pagination-next","click",function(){var a,s,o,l,d,n,c,g,u,p;a=e.getFirstCategory(),o=e.getLabel(),s=e.getCategory(),p=e.getSort(),g=e.getPriceDos(),l=g.price,d=g.deliver,n=g.os,c=g.customerGroup,u=t(this).attr("rel"),i=parseInt(u),t(".ant-pagination-next").find("a").hasClass("discursor")||r.getListProduct(e.getRequset().keyword,a,s,o,i-1,l,d,n,c,p)}),t(".product-line-time").bind("click",function(){var t,a,i,r,l,d,n,c,g;t=e.getFirstCategory(),g=e.getLabel(),c=e.getCategory(),n=e.getPriceDos(),i=n.price,r=n.deliver,l=n.os,d=n.customerGroup,o?(e.showSortBtn(".quick-sort span.rel",".product-line-time",".uf-triangle-down"),a="approveTime,desc",o=!1):(e.showSortBtn(".quick-sort span.rel",".product-line-time",".uf-triangle-up"),a="approveTime,asc",o=!0),s.getListProduct(e.getRequset().keyword,t,c,g,void 0,i,r,l,d,a)}),t(".product-price").bind("click",function(){var t,a,i,r,l,d,n,c,g;t=e.getFirstCategory(),g=e.getLabel(),c=e.getCategory(),n=e.getPriceDos(),i=n.price,r=n.deliver,l=n.os,d=n.customerGroup,o?(e.showSortBtn(".quick-sort span.rel",".product-price",".uf-triangle-down"),a="lowestPrice,desc",o=!1):(e.showSortBtn(".quick-sort span.rel",".product-price",".uf-triangle-up"),a="lowestPrice,asc",o=!0),s.getListProduct(e.getRequset().keyword,t,c,g,void 0,i,r,l,d,a)}),t(".product-default").bind("click",function(){var t,a,i,r,l,d,n,c,g;t=e.getFirstCategory(),g=e.getLabel(),c=e.getCategory(),n=e.getPriceDos(),i=n.price,r=n.deliver,l=n.os,d=n.customerGroup,a="default",o?(e.showSortBtn(".quick-sort span.rel",".product-default",".uf-triangle-down"),o=!1):(e.showSortBtn(".quick-sort span.rel",".product-default",".uf-triangle-up"),o=!0),s.getListProduct(e.getRequset().keyword,t,c,g,void 0,i,r,l,d,a)}),t(".product-class dd").delegate("span","click",function(a){var i,r,o,l,d,n,c,g,u,p,v,h;t(".ul-class").removeClass("y-hide"),t(this).hasClass("level2stop")?(n=t(this).attr("data-level"),u="",u+="<div class='item'>",u+="<i class='uf uf-arrow-right icon-color font-size-10'></i>",u+="<span class='title padding-right-5'>",u+="<span class='btn' data-level="+n+">"+t(this).text()+"</span>",u+="<i class='uf uf-triangle-down  font-size-10'></i>",u+="<div class='sub y-hide'>",u+=" <ul class='y-clear' >",t.each(t(".level2stop"),function(e,a){c=t(a).attr("data-level"),u+="<li class='sencondCate' data-level2="+c+">"+a.innerText+"</li>"}),u+="</ul>",u+="</div>",u+="</div>",t(".search .class-list").append(u),t(".product-class").addClass("dn")):(d=t(this).attr("data-level"),p="",p+="<div class='item allCategory'>",p+="<span class='title'>全部分类</span>",p+="</div>",g="",g+="<div class='item'>",g+="<i class='uf uf-arrow-right icon-color font-size-10'></i>",g+="<span class='title padding-right-5'>",g+="<span class='btn' data-level="+d+">"+t(this).text()+"</span>",g+="<i class='uf uf-triangle-down  font-size-10'></i>",g+="<div class='sub y-hide'>",g+=" <ul class='y-clear' >",t.each(dataLevelCate,function(t,e){g+="<li class='firstCateg' data-level="+e.categoryId+">"+e.categoryName+"</li>",d==e.categoryId&&(e.productCategoryDtoList.length>0?dataLeve2Cate=e.productCategoryDtoList:dataLeve2Cate="此一级分类下没有二级分类")}),g+="</ul>",g+="</div>",t(".search .class-list").append(p).append(g),e.setDataCategory(dataLeve2Cate)),l=e.getLabel(),e.removeActive(),t(this).hasClass("levelFirst")?(i=t(this).attr("data-level"),r=t(this).text(),s.getListProduct(e.getRequset().keyword,i,o,l),s.getAdvertSing(r)):t(this).hasClass("level2stop")&&(i=e.getFirstCategory(),v=e.getMarketName(),h=t(this).text(),r=v+"$$"+h,o=t(this).attr("data-level"),s.getListProduct(e.getRequset().keyword,i,o,l),s.getAdvertSing(r)),a.stopPropagation()}),t(document).on("mouseover mouseout",".class-list .item ",function(e){"mouseover"==e.type?t(this).find(".sub").removeClass("y-hide"):"mouseout"==e.type&&t(this).find(".sub").addClass("y-hide")}),t(".y-clear").delegate(".firstCateg","click",function(a){var i,r,o,l,d;l=t(this).attr("data-level"),t.each(dataLevelCate,function(t,e){l==e.categoryId&&(d=e.productCategoryDtoList.length>0?e.productCategoryDtoList:"此一级分类下没有二级分类")}),e.setDataCategory(d),o=e.getLabel(),i=t(this).attr("data-level"),r=t(this).text(),t(".item .btn").attr("data-level",i),t(".padding-right-5 .btn").html(t(this).text()),e.removeCategory(),e.removeActive(),s.getListProduct(e.getRequset().keyword,i,void 0,o),s.getAdvertSing(r),a.stopPropagation()}),t(".y-clear").delegate(".sencondCate","click",function(a){var i,r,o,l,d,n;i=e.getFirstCategory(),l=e.getMarketName(),d=t(this).text(),o=e.getLabel(),n=l+"$$"+d,r=t(this).attr("data-level2"),t(".padding-right-5 .btn").eq(1).html(t(this).text()),e.removeActive(),s.getListProduct(e.getRequset().keyword,i,r,o),s.getAdvertSing(n),a.stopPropagation()}),t(".product-list").delegate("span.tagBtn","click",function(){var a,i,r,o,l,d,n,c,g;a=e.getFirstCategory(),r=t(this).attr("data-label"),i=e.getCategory(),g=e.getPriceDos(),l=g.price,d=g.deliver,n=g.os,c=g.customerGroup,t(".ul-class").removeClass("y-hide"),t(".tag-list").remove(),o="",o+="<span></span>",o+="<div class='tag-list y-left'>",o+="<div class='ml-line  y-left y-mr3'></div>",o+="<dt class='title' >标签</dt>",o+="<dd><span class='innerLab-text'data-label="+r+">"+t(this).text()+"</span><i class='close'></i> ",o+="</dd>",o+="</div>",t(".ul-class").append(o),s.getListProduct(e.getRequset().keyword,a,i,r,void 0,l,d,n,c)}),t(".search").delegate(".close","click",function(){var a,i,r,o,l,d,n,c,g;a=e.getFirstCategory(),r=e.getLabel(),i=e.getCategory(),g=e.getPriceDos(),l=g.price,d=g.deliver,n=g.os,c=g.customerGroup,o=t(this).parent().parent(),o.parent().find(".item").length>0?o.remove():(o.remove(),t(".ul-class").addClass("y-hide")),s.getListProduct(e.getRequset().keyword,a,i,r,void 0,l,d,n,c)}),t(".m-pro-item").delegate(".btn","click",function(){var a,i,r,o,l,d,n,c;t(this).siblings().removeClass("chose-active"),t(this).addClass("chose-active"),l=e.getFirstCategory(),n=e.getLabel(),d=e.getCategory(),o=e.getPriceDos(),a=o.price,i=o.deliver,r=o.os,c=o.customerGroup,s.getListProduct(e.getRequset().keyword,l,d,n,void 0,a,i,r,c)}),t(".class-list").delegate(".allCategory","click",function(){t(".search .class-list").empty(),t(".product-class").removeClass("dn"),t(".firstLevel").empty(),t(".ul-class").addClass("y-hide"),t.each(dataLevelCate,function(e,a){t(".firstLevel").append('<span class="levelFirst btn" data-level='+a.categoryId+">"+a.categoryName+"</span>")}),s.getListProduct(e.getRequset().keyword,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)})},getListProduct:function(i,r,o,l,d,n,c,g,u,p){s=this;var v,h;t.ajax({type:"get",url:"/search/product/s",data:{keyword:i||"",market:r||"",category:o||"",label:l||"",page:d||"",price:n||"",deliver:c||"",os:g||"",customerGroup:u||"",sort:p||""},dataType:"JSON",async:!1,cache:!1,beforeSend:function(t){r&&(void 0==o&&(o=""),window.location.hash="#marketId="+r+"&categoryId="+o)},success:function(i){1==i.status&&(h=i.data.content,null!=h&&h.length>0?(total=i.data.totalElements,pageSize=i.data.size,totalPage=i.data.totalPages,total=total>0?total:0,t(".product-Count").text(total),v=a("productUl",i.data),document.querySelector(".product-ul").innerHTML=v,t(".pages-ul").removeClass("dn"),t("#pagecount").children().remove(),s.getPageBar(totalPage),e.getUndefindImage(".view-img img"),window.scrollTo(0,0)):(t(".product-Count").text(0),t(".product-ul").html('<h1 class="tc padding-20">没有查询到您搜索的产品</h1>'),t(".pages-ul").addClass("dn")))},error:function(){t(".product-Count").text(0),t(".product-ul").html('<h1 class="tc padding-20">服务器延迟...</h1>'),t(".pages-ul").addClass("dn")}})},getProductCategory:function(){s=this,t.ajax({type:"get",url:"/market/product/category",dataType:"JSON",async:!1,cache:!1,success:function(e){var a;1==e.status?(a=e.data,a.length>0?(dataLevelCate=a,t.each(a,function(e,a){t(".firstLevel").append('<span class="levelFirst btn" data-level='+a.categoryId+">"+a.categoryName+"</span>"),a.productCategoryDtoList.length>0?t(".levelFirst").data("level-key"+e,a.productCategoryDtoList):t(".levelFirst").data("level-key"+e,"产品二级分类的内容为空")})):document.querySelector(".search").innerHTML='<h1 class="tc padding-20">没有查询到分类信息</h1>'):document.querySelector(".search").innerHTML='<h1 class="tc padding-20">没有查询到分类信息</h1>'},error:function(){alert("分类数据加载失败")}})},getAdvertSing:function(s){var i;t.ajax({type:"get",url:"/api/cms/getdetail/name/"+s,dataType:"JSON",cache:!1,success:function(s){t(".advertisement").html(""),200==s.code&&s.res.length>=3&&(s.res.length=3,i=a("adverPro",s),t(".advertisement").html(i),t(".advertisement__item").eq(1).addClass("advertisement__item--middle"),e.getUndefindImage(".advertisement__item__icon img"))},error:function(){t(".advertisement").html('<h1 class="tc padding-20">服务器延迟...</h1>')}})},getPageBar:function(e){var a='<li title="上一页" rel="'+(parseInt(i)-1)+'" class=" ant-pagination-prev">';a+="<a>上一页</a>",a+="</li>";var s='<li title="下一页" rel="'+(parseInt(i)+1)+'" class=" ant-pagination-next">';s+="<a> 下一页 </a>",s+="</li>";var r="";if(e>1){for(var o=0;o<e;o++)r+='<li rel="'+(o+1)+'"class="ant-pagination-item">',r+="<a>"+(o+1)+"</a>",r+="</li>";t("#pagecount").append(a+r+s),1==i?(t(".ant-pagination-prev").find("a").addClass("discursor"),t(".ant-pagination-item").eq(0).addClass("addActive")):i<e?t(".ant-pagination-item").eq(i-1).addClass("addActive"):i==e?(t(".ant-pagination-item").eq(i-1).addClass("addActive"),t(".ant-pagination-next").find("a").addClass("discursor")):i<1&&(t(".ant-pagination-item").eq(i-1).addClass("addActive"),t(".ant-pagination-prev").find("a").addClass("discursor"))}else 1==e&&(r+='<li rel="1"class="ant-pagination-item addActive">',r+="<a>1</a>",r+="</li>",t("#pagecount").append(a+r+s),t(".ant-pagination-prev").find("a").addClass("discursor"),t(".ant-pagination-next").find("a").addClass("discursor"));i=1},showNavData:function(e,a){t(".class-list ").empty(),t(".firstLevel").empty();var s,i,r,o,l,d,n="";t.each(dataLevelCate,function(r,o){n+="<li class='firstCateg' data-level="+o.categoryId+">"+o.categoryName+"</li>",e==o.categoryId&&(s=o.categoryName,o.productCategoryDtoList.length>0?(d=o.productCategoryDtoList,t.each(d,function(e,s){t(".firstLevel").append('<span class="level2stop btn" data-level='+s.categoryId+">"+s.categoryName+"</span>"),a==s.categoryId?i=s.categoryName:t(".product-class").removeClass("dn")})):(d="此一级分类下没有二级分类",t(".product-class").addClass("dn")))}),s&&(t(".ul-class").removeClass("y-hide"),l="",l+="<div class='item allCategory'>",l+="<span class='title'>全部分类</span>",l+="</div>",r="",r+="<div class='item'>",r+="<i class='uf uf-arrow-right icon-color font-size-10'></i>",r+="<span class='title padding-right-5'>",r+="<span class='btn' data-level="+e+">"+s+"</span>",r+="<i class='uf uf-triangle-down  font-size-10'></i>",r+="<div class='sub y-hide'>",r+=" <ul class='y-clear' >",r+=n,r+="</ul>",r+="</div>",t(".search .class-list").append(l).append(r),i&&(o="",o+="<div class='item'>",o+="<i class='uf uf-arrow-right icon-color font-size-10'></i>",o+="<span class='title padding-right-5'>",o+="<span class='btn' data-level="+a+">"+i+"</span>",o+="<i class='uf uf-triangle-down  font-size-10'></i>",o+="<div class='sub y-hide'>",o+=" <ul class='y-clear' >",t.each(d,function(t,e){o+="<li class='sencondCate' data-level2="+e.categoryId+">"+e.categoryName+"</li>"}),o+="</ul>",o+="</div>",o+="</div>",t(".search .class-list").append(o),t(".product-class").addClass("dn")))}};t(function(){r.init()})});
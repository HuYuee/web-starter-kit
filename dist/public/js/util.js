define(["jquery","template"],function(e,t){var n={debug:!0,loginStat:!1,getUserCount:0,marketServer:"undefined"!=typeof marketConfig&&marketConfig.marketServer||"",isDev:"localhost"===location.hostname||"127.0.0.1"===location.hostname,init:function(){var t=this;t.log("进入util.js"),0!==e(".J_SearchText").size()&&t.getSearchKeyWord(),t.getBaiduStatic(),t.bindEvent(),t.getUserData(),t.initNavTab()},log:function(e){this.debug},bindEvent:function(){var t=this;e(".inputcontrol").click(function(){var n,a,r;r=e.trim(e(this).parent().find(".J_SearchText").val()),e(".J_SearchText").val(r),n="localhost"==window.location.hostname?"./list.html?keyword=":t.marketServer+"/market/search?keyword=",a=t.IETester(),window.location.href=a?n+encodeURIComponent(r):n+r}),e(".J_SearchText").keydown(function(n){var a,r;if(13==n.which){var i=e.trim(e(".J_SearchText").val());e(".J_SearchText").val(i),a="localhost"==window.location.hostname?"./list.html?keyword=":t.marketServer+"/market/search?keyword=",r=t.IETester(),window.location.href=r?a+encodeURIComponent(i):a+i}}),e(window).scroll(function(){var t=e(window).scrollTop();e(window).height();0!=t?e(".backtop , .hide-backtop").addClass("active"):e(".backtop , .hide-backtop").removeClass("active")}),e(".backtop , .hide-backtop").on("click",function(){document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop;e("html,body").animate({scrollTop:"0px"})});var n=window.location.href;e(".btn-logo").click(function(){var e=t.marketServer+"/market/jump.jsp?target=",a=t.URLencode(n);window.location.href=e+a}),e(".btn-register").click(function(){var e=t.marketServer+"/market/register?service=",a=t.URLencode(n);window.location.href=e+a}),e(".btn-leave").click(function(){e.ajax({type:"get",url:t.marketServer+"/market/logout",dataType:"jsonp",cache:!1,success:function(t){window.location.href=t.logouturl,e(".pre_login").removeClass("dn"),e(".header_navbar-nav").addClass("dn")}})})},getUserData:function(){that=this,e.ajax({type:"get",url:n.marketServer+"/market/user",dataType:"jsonp",cache:!1,success:function(t){that.getUserCount++,1==t.status?""!=t.user.userId?(that.loginStat=!0,/^1(3|4|5|7|8)\d{9}$/.test(t.user.userName)?e(".btn-logo").text(t.user.userName.substring(0,7)+"****"):e(".btn-logo").text(t.user.userName),e(".supplier_link").removeClass("notlogin"),e(".btn-register").parent(".rightfont").addClass("dn"),e(".btn-leave").parent(".rightfont").removeClass("dn"),e(".pre_login").addClass("dn"),e(".header_navbar-nav").removeClass("dn"),e(".header_navbar-nav .header_dropdown").css("list-style","none").css("list-style-position","inside"),e.ajax({type:"get",url:that.marketServer+"/market/isv/status",dataType:"jsonp",cache:!1,success:function(t){if(1==t.status){var n=t.data.certificationStatus;1==t.data.enableStatus?1==n?(e(".supplier_link").find("span").html("服务商认证"),e(".supplier_link").attr("href",that.marketServer+"/market/settled")):2==n?(e(".supplier_link").find("span").html("服务商中心"),e(".rightservice").html("审核中").addClass("not-allowed"),e(".not-allowed").parent()[0].addEventListener("click",function(e){e.preventDefault()},!1)):3==n?(e(".supplier_link").find("span").html("服务商中心"),e(".supplier_link").attr("href",that.marketServer+"/market/operations")):4==n&&(e(".supplier_link").find("span").html("服务商认证"),e(".supplier_link").attr("href",that.marketServer+"/market/settled")):(e(".supplier_link").find("span").html("服务商认证"),e(".supplier_link").attr("href",that.marketServer+"/market/settled"))}}})):that.loginStat=!1:t.status||(e(".supplier_link").find("span").html("服务商认证"),e(".supplier_link").attr("href",that.marketServer+"/market/settled"),0==e("#iframer").length&&e("body").append("<iframe src='"+that.marketServer+"/market/login.jsp' id='iframer' hidden='hidden' style='height:0;border:none'> </iframe>"))},error:function(e){}})},showMsg:function(e,t,n){switch(n){case 1:var a=dialog({content:e,align:"right",quickClose:!0});a.show(document.getElementById(t));break;case 2:var a=dialog({content:e});a.show(),setTimeout(function(){a.close().remove()},3e3)}},getSearchKeyWord:function(){var n={status:1,hot:"在此输入您需要的服务",data:[{name:"全能环境"},{name:"数据迁移"},{name:"PHP运行环境"},{name:"linux环境配置"},{name:"JAVA运行环境"},{name:"一键部署"},{name:"智能防御"}]};if(t.helper("searchFormat",function(e){return encodeURI(e)}),e(".J_SearchText").attr("placeholder",n.hot),0!=e("#J_SearchKeyTemplate").size()){var a=t("J_SearchKeyTemplate",n);e(".J_SearchKey").html(a)}},URLencode:function(e){return escape(e).replace(/\+/g,"%2B").replace(/\"/g,"%22").replace(/\'/g,"%27").replace(/\//g,"%2F")},setCookie:function(e,t){var n=new Date;n.setTime(n.getTime()+2592e6),document.cookie=e+"="+escape(t)+";expires="+n.toGMTString()},getCookie:function(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?unescape(t[2]):void 0},isLogin:function(){return-1!=window.document.cookie.indexOf("at")},getClientDateTime:function(e){var t={"M+":(new Date).getMonth()+1,"d+":(new Date).getDate(),"H+":(new Date).getHours(),"m+":(new Date).getMinutes(),"s+":(new Date).getSeconds(),"q+":Math.floor(((new Date).getMonth()+3)/3),S:(new Date).getMilliseconds()},n=(new Date).getFullYear(),a=n+"";a=a.length>=4?a:"0000".substr(0,4-a.length)+a,/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(a+"").substr(4-RegExp.$1.length)));for(var r in t)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[r]:("00"+t[r]).substr((""+t[r]).length)));return e},getRequset:function(){var e=location.search,t=new Object;if(-1!=e.indexOf("?")){var n=e.substr(1);strs=n.split("&");for(var a=0;a<strs.length;a++)t[strs[a].split("=")[0]]=strs[a].split("=")[1]}return t},getRestful:function(){var e=location.pathname,t=[];return-1!=e.indexOf("html")?t.push(location.pathname.substring(1,location.pathname.length-5)):t=e.split("/").reverse(),t},parseURIComponent:function(e){return decodeURIComponent(e)},encodeURIComponent:function(e){return encodeURIComponent(e)},getUndefindImage:function(t){e(t).error(function(){e(this).attr("src","http://static.imyy.org/wp-content/uploads/2017/02/default.jpg")})},showSortBtn:function(t,n,a){e(t).children("i").removeClass("chose-sort-color"),e(n).parent().find(a).addClass("chose-sort-color")},emptyString:function(e){return-1!=e.indexOf("全部")?e="":e},getSort:function(){var t;if(e(".chose-sort-color").length>0){var n=e(".chose-sort-color").parent().find("a").text().trim();"价格"==n?1==e(".chose-sort-color").hasClass("uf-triangle-down")?t="lowestPrice,desc":1==e(".chose-sort-color").hasClass("uf-triangle-up")&&(t="lowestPrice,asc"):"上架时间"==n?1==e(".chose-sort-color").hasClass("uf-triangle-down")?t="approveTime,desc":1==e(".chose-sort-color").hasClass("uf-triangle-up")&&(t="approveTime,asc"):"默认排序"==n&&(t="default")}return t},getLabel:function(){if(e(".ul-class .tag-list").length>0)return e(".ul-class .innerLab-text").attr("data-label")},getFirstCategory:function(){var t;if(e(".ul-class .item").length>0)return e.each(e(".ul-class .item"),function(n,a){1==n&&(t=e(a).find(".btn").attr("data-level"))}),t},getCategory:function(){var t;if(e(".ul-class .item").length>0)return e.each(e(".ul-class .item"),function(n,a){2==n&&(t=e(a).find(".btn").attr("data-level"))}),t},getPriceDos:function(){var t,n,a,r,i,o;return i={},t=e(".m-pro-item").find(".chose-active"),e.each(t,function(t,i){0==t?(n=e(i).text(),"免费"==n&&(n="0"),n=that.emptyString(n),n=-1!=n.indexOf("以上")?n.substr(0,n.length-2):n.replace("-",",")):1==t?a=that.emptyString(e(i).attr("value")):2==t?r=that.emptyString(e(i).text()):3==t&&(o=that.emptyString(e(i).attr("value")))}),i.price=n,i.deliver=a,i.os=r,i.customerGroup=o,i},getMarketName:function(){var t;if(e(".ul-class .item").length>0)return e.each(e(".ul-class .item"),function(n,a){1==n&&(t=e(a).find(".btn").text())}),t},getCategoryName:function(){var t;if(e(".ul-class .item").length>0)return e.each(e(".ul-class .item"),function(n,a){2==n&&(t=e(a).find(".btn").text())}),t},removeActive:function(){var t=e(".m-pro-item");e.each(t,function(t,n){e(n).find(".btn").removeClass("chose-active"),e(n).find(".btn").eq(0).addClass("chose-active")})},removeCategory:function(){var t=e(".ul-class .item");t.length>0&&e.each(t,function(t,n){t>1&&e(n).remove()})},removeLabel:function(){var t=e(".tag-list");t.length>0&&t.remove()},getHashValue:function(){var t={},n=window.location.hash,a=n.substr(1),r=a.split("&");return e.each(r,function(e,n){var a=n.split("=");0==e&&(t.market=a[1]),1==e&&(t.category=a[1])}),t},initNavTab:function(){e.fn.fixedNav=function(){var t=e(this),a=this.selector;fixedNav=t.clone().addClass("details-nav-fixed").css("width",t.width()),e(".item-intro").append(fixedNav);var r=t.offset().top,i=n.calculationNavHeight(e(this).find("a"));e(window).scroll(function(t){if(n.isfixedNavClick)return void(n.isfixedNavClick=!1);var a=e(this).scrollTop();r<=a&&(n.fixedNavShow=!0,e(".details-nav-fixed").css({"z-index":"11111",display:"block"}),n.setNavActive(a,i)),r>a&&n.fixedNavShow&&(n.fixedNavShow=!1,e(".details-nav-fixed").css({"z-index":"-11",display:"none"}),n.setActive(0))}),e(a).on("click",function(t){var a=null;"A"===t.target.nodeName||"SPAN"===t.target.nodeName?a=e(t.target).parents("li").index():"LI"===t.target.nodeName&&(a=e(t.target).index()),null!=a&&(n.fixedNavShow||(n.fixedNavShow=!0,e(".details-nav-fixed").css({"z-index":"11111",display:"block"})),n.isfixedNavClick=!0,n.setActive(a))})}},setActive:function(t){e(".details-nav-fixed").find(".active").removeClass("active"),e(e(".details-nav-fixed").find("a")[t]).parent().addClass("active")},setNavActive:function(e,t){for(var a=0,r=0,i=t.length-1;r<i;++r){if(t[r]<e&&t[r+1]>=e){a=r-1,-1===a&&(a=0);break}if(e>t[i]){a=i-1;break}}n.setActive(a)},IETester:function(e){var t=e||navigator.userAgent;return/msie/i.test(t)?t.match(/msie (\d+\.\d+)/i)[1]:!(!~t.toLowerCase().indexOf("trident")||!~t.indexOf("rv"))&&t.match(/rv:(\d+\.\d+)/)[1]},calculationNavHeight:function(t){var n=[0];if(t){for(var a=0,r=t.length;a<r;++a){var i=e(t[a]).attr("href");n.push(e(i).offset().top-200)}return n}},strTrim:function(e,t){var n;return n=e.replace(/(^\s+)|(\s+$)/g,""),"g"==t.toLowerCase()&&(n=n.replace(/\s/g,"")),n},setDataCategory:function(t){e(".firstLevel").empty(),"object"==typeof t?(e(".product-class").removeClass("dn"),e.each(t,function(t,n){e(".firstLevel").append('<span class="level2stop btn" data-level2='+n.categoryId+">"+n.categoryName+"</span>")})):"string"==typeof t&&e(".product-class").addClass("dn")},getBaiduStatic:function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?cca871f3eb9c84e0eb8548a09946a838";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}},a={_check:function(){return"placeholder"in document.createElement("input")},init:function(){this._check()||this.fix()},fix:function(){jQuery(":input[placeholder]").each(function(t,n){var a=e(this),r=a.attr("placeholder");a.wrap(e("<div></div>").css({position:"relative",zoom:"1",border:"none",background:"none",padding:"none",margin:"none"}));var i=a.position(),o=a.outerHeight(!0),s=a.css("padding-left"),c=e("<span></span>").text(r).css({position:"absolute",left:i.left,top:"5px",height:o,lienHeight:o,paddingLeft:s,color:"#aaa"}).appendTo(a.parent());if(e(".J_SearchText").length>0){var l=that.parseURIComponent(that.getRequset().keyword);"undefined"!=l&&l.length>0&&c.hide()}a.focusin(function(e){c.hide()}).focusout(function(e){a.val()||c.show()}),c.click(function(e){c.hide(),a.focus()})})}};return n.init(),window.getUserData=n.getUserData,a.init(),n});